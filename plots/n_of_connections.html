<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Number of Connections</title>
</head>
<body>
<div id="plot"></div>

<script src="https://cdn.plot.ly/plotly-2.6.3.min.js"></script>

<script>
  PLOT = document.getElementById('plot');

  layout = {
    title: 'Number of Connections',
    height: 1000,
    showlegend: true,
    xaxis: {
      tickmode: "array", // If "array", the placement of the ticks is set via `tickvals` and the tick text is `ticktext`.
      tickvals: [0,3600,7200,10800,14400,18000,21600,25200, 28800, 32400, 36000, 39600, 43200],
      ticktext: ['8 am', '9 am', '10 am', '11 am', '12 Lunch', '1 pm', '2 pm','3 pm','4 pm','5 pm','6 pm', '7 pm','8 pm Exit']
    }
  }

  config = {
    responsive: true
  }

  traces = []

  accessPoints = {
    0: "HS1",
    1: "Offices",
    2: "Computer Lab",
    3: "Offices",
    4: "Study Zone",
    5: "Tutorial",
    6: "Study Zone",
    7: "Tutorial",
    8: "Tutorial",
    9: "Library",
    10: "Offices",
    11: "Offices",
    12: "Cafeteria",
    13: "Tutorial",
    14: "HS3",
    15: "Offices",
    16: "HS2",
    17: "Offices"
  }

  colors = {
    0: "#E9AFB7",
    1: "#254A9D",
    2: "#F35E7A",
    3: "#437F94",
    4: "#FF8C0A",
    5: "#CAFE08",
    6: "#E9A708",
    7: "#79EF8B",
    8: "#3E9916",
    9: "#A206D3",
    10: "#52679E",
    11: "#3969C1",
    12: "#E42020",
    13: "#127510",
    14: "#BD60B9",
    15: "#63ABBB",
    16: "#A91568",
    17: "#A7D5D5"
  }

  for (let i = 0; i < 18; i++) {
    // const randomColor = Math.floor(Math.random()*16777215).toString(16);
    //
    // let trace = { name: 'AP ' + i, x: [], y: [] , marker: {color: "#" + randomColor}}
    let trace = { name: 'AP ' + i, x: [], y: [] , marker: {color: colors[i]}}
    traces.push(trace)
  }

  Plotly.newPlot(PLOT, traces, layout, config)

  let granularity = 100

  for (ap = 0; ap < 18; ap++) {
    let file_path =  "../reports/AP" + ap + "_" + granularity + ".txt"
    Plotly.restyle(PLOT, {name: accessPoints[ap]}, [ap])

    rawFile = new XMLHttpRequest();
    rawFile.open("GET", file_path, false);
    rawFile.onreadystatechange = function () {
      if (rawFile.readyState === 4) {
        if (rawFile.status === 200 || rawFile.status == 0) {
          let allText = rawFile.responseText;
          let lines = allText.split('\n');
          for (let line = 0; line < lines.length; line++) {
            let numbers = lines[line].split(' ')
            let t_data = numbers[0]
            let n_data = numbers[1]

            Plotly.extendTraces(PLOT, {x: [[t_data]], y: [[n_data]]}, [ap])
          }
        }
      }
    }
    rawFile.send(null);
  }

</script>
</body>
</html>